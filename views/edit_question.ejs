<%- include("partials/header") %>
<%- include("partials/adminSideBar") %>
<div class="container mt-3 mb-3">
   <div class="row justify-content-center">
      <div class="offset-2 col-8 offset-sm-1 col-sm-10 offset-md-1 col-md-11">
         <div class="text-center p-3 m-3 font-monospace">
            <h1 class="display-4">Update the <span class="blue">Object</span> to identify</h1>
         </div>
            <div class="row justify-content-center">
               <div class="col-12 col-md-6 card p-4 shadow">
                  <!-- <h2 class="card-title text-center">Choose the <span class="blue">Image</span> of Object</h2> -->
                  <div class="row justify-content-center my-2 text-center">
                     <div class="col-12 col-sm-7 col-md-6" id="preview">
                        <img src="data:image/<%=question.question.contentType%>;base64,<%=question.question.data.toString('base64')%>" class="img-fluid" width="300" style="max-height:300px;border:2px solid #6C63FF;padding:2px">
                     </div>
                  </div>
                  <div class="row justify-content-center">
                        <div class="col-12 col-md-6">
                           <input type="text" name="answer" id="login-input" placeholder="Name of Object..." value="<%=question.answer%>" readonly> 
                        </div>
                        <div class="col-12 col-md-6">
                           <input type="number" name="level" id="login-input1"  placeholder="Enter Level(1-5)..." onchange="checklevel(this.value)" value="<%=question.level%>" readonly>
                        </div>
                        <div class="col-12 col-md-6">
                           <input type="text" name="score" id="login-input" placeholder="Description..." value="<%=question.score%>" readonly>
                        </div>
                  </div>
                  <div class="text-center">
                     <button class="btn btn-lg btn-primary white m-1" type="submit">
                        <i class="fas fa-edit"></i>
                     </button>
                  </div>
               </div>
            </div>
            <div class="text-center p-3 m-3 font-monospace">
               <h1 class="display-5">Update <span class="blue">hints</span> to identify</h1>
            </div>
            <div class="row justify-content-center mt-3">
               <% for (var i = 0; i < 4; i++) { %>
               <div class="col-12 col-md-5 card shadow m-1 p-4">
                  <!-- <h2 class="card-title text-center">Add hint<%= i+1 %></h2> -->
                  <div class="row justify-content-center">
                     <div id="preview-hint<%= i %>" class="my-2 col-11 col-sm-9 col-md-7 text-center">
                        <img src="data:image/<%=question.hints[i].hint.contentType%>;base64,<%=question.hints[i].hint.data.toString('base64')%>" class="img-fluid" width="300" style="height:40vh;border:2px solid #6C63FF;padding:2px">
                     </div>
                     <div class="col-12">
                        <input type="text" name="nscore[<%= i %>]" id="login-input" placeholder="Description..." value="<%=question.hints[i].score%>" readonly>
                     </div>
                  </div>  
                  <div class="text-center">
                     <% let img1=question.hints[i].hint.contentType %>
                     <% let img2=question.hints[i].hint.data.toString('base64') %>
                     <button class="btn btn-lg btn-primary white m-1" data-bs-toggle="modal" data-bs-target="#editHintModal" data-bs-whatever="[<%=i%>,<%=img1%>,<%=img2%>">
                        <i class="fas fa-edit"></i>
                     </button>
                  </div>  
               </div>
               <% } %>
            </div>
      </div>
   </div>
</div>
<%- include("partials/editHintModal") %>
<script>
   function getImagePreview(event,preview_id,upload_id){
      const fi = document.getElementById(upload_id);
      const fsize = fi.files.item(0).size;
      const file = Math.round((fsize / 1024));
      if (file >= 1024) {
         alert("File too Big, please select a file less than 1mb");
         document.getElementById(upload_id).value = '';
         var imagediv= document.getElementById(preview_id);
         var newimg=document.createElement('img');
         imagediv.innerHTML='';
         newimg.src='';
      }
      else{
         var image=URL.createObjectURL(event.target.files[0]);
         var imagediv= document.getElementById(preview_id);
         var newimg=document.createElement('img');
         imagediv.innerHTML='';
         newimg.src=image;
         newimg.className="img-fluid";
         newimg.width="300";
         newimg.style="max-height:300px;border:2px solid #6C63FF;padding:2px";
         imagediv.appendChild(newimg);
         var removebtn=document.createElement('button');
         removebtn.className="btn btn-sm blue text-center";
         removebtn.innerHTML='<i class="fa-solid fa-xmark"></i>'
         removebtn.setAttribute('onclick','removeImg('+upload_id+','+preview_id+')')
         imagediv.appendChild(removebtn);
      }
  }

  function removeImg(upload_id,preview_id){
    document.getElementById(upload_id).value = '';
    var imagediv= document.getElementById(preview_id);
    var newimg=document.createElement('img');
    imagediv.innerHTML='';
    newimg.src='';
  }

  var editHintModal = document.getElementById('editHintModal')
  editHintModal.addEventListener('show.bs.modal', function (event) {
   var button = event.relatedTarget
   var hint_details = button.getAttribute('data-bs-whatever').slice(1,-1).split(',');
   console.log(hint_details);
   document.getElementById('img-preview').src='"data:image/'+hint_details[1]+';base64,'+hint_details[2];
})
 </script>
<%- include("partials/footer") %>



